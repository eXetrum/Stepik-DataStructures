(()=>{"use strict";var e,t={46729:(e,t,r)=>{r(57147);var n=r(57588),a=r.n(n),i=r(73935),o=r(45697),s=r.n(o),l=function(e){var t=e.children,r=e.universityLogo;return a().createElement("div",{className:"backdrop"},a().createElement("div",{className:"modal ".concat(e.className)},a().createElement("div",{className:"header"},r?a().createElement("img",{className:"uni-logo",src:r,alt:"University logo"}):"",a().createElement("img",{className:"brand-logo",src:"https://cdn.oreillystatic.com/images/sitewide-headers/oreilly_logo_mark_red.svg",alt:"O’Reilly"})),a().createElement("div",{className:"content"},t)))};l.propTypes={children:s().oneOfType([s().arrayOf(s().node),s().node]),className:s().string,universityLogo:s().string};const c=l;function u(e){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u(e)}function d(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function m(e,t){return m=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},m(e,t)}function h(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=p(e);if(t){var a=p(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return f(this,r)}}function f(e,t){if(t&&("object"===u(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return v(e)}function v(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function p(e){return p=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},p(e)}var g=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&m(e,t)}(o,e);var t,r,n,i=h(o);function o(e){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),t=i.call(this,e);var r=new URLSearchParams(window.location.search);return t.state={show:!1,universityLogo:"",uiState:e.federatedAuthEnabled?"federated":"capture",email:r.get("email")||"",timestamp:r.get("tstamp")||"",signature:r.get("id")||"",error:"",federatedInstitution:"",mlfaIDPProviders:"",accountIdentifier:"",ipAuth:!1,referrerAuth:!1,idProviders:[],chosenIdProvider:""},e.accountIdentifier?(t.state.accountIdentifier=e.accountIdentifier,t.state.referrerAuth=!0,t.state.uiState="referrerVerified",t.state.show=!0):t.get(t.fullLearningURL("/api/v1/account-summary-by-network/")).then((function(e){e.identifier&&!0===e.allow_ip_based_authentication&&(t.state.accountIdentifier=e.identifier,t.state.ipAuth=!0,t.state.uiState="ipVerified");var r=t.state.uiState;if(e.headers){var n=e.headers.get("X-EZP-User")||"";n&&(t.state.email=n)}t.state.email&&t.state.timestamp&&t.state.signature?(r="ezproxy-sso",t.registerUser()):e.sso_login_url&&(r="sso");var a={show:!0,universityLogo:e.logo,uiState:r};t.setState(a)})).catch((function(){t.props.forceShow&&t.setState({show:!0})})),t.determineSsoStatus=t.determineSsoStatus.bind(v(t)),t.handleFederatedSelectionChange=t.handleFederatedSelectionChange.bind(v(t)),t.handleInputChange=t.handleInputChange.bind(v(t)),t.handleInstitutionNotListed=t.handleInstitutionNotListed.bind(v(t)),t.registerTemporaryUser=t.registerTemporaryUser.bind(v(t)),t.registerUser=t.registerUser.bind(v(t)),t.handleIdProviderSelection=t.handleIdProviderSelection.bind(v(t)),t.redirectToChosenIdProvider=t.redirectToChosenIdProvider.bind(v(t)),t}return t=o,r=[{key:"componentDidMount",value:function(){var e=this;if("federated"===this.state.uiState){var t=function(e){switch(e){case"production":return"com";case"qa":return"review";default:return"local"}}(this.props.env);this.setState({tld:t}),this.get("/library/view/api/mlfa-idp-list/").then((function(t){if(!e.state.ipAuth){var r=JSON.parse(t);e.setState({mlfaIDPProviders:r}),e.setState({uiState:"federated"})}})).catch((function(){e.state.ipAuth||e.setState({uiState:"capture"})}))}}},{key:"handleInputChange",value:function(e){this.setState({email:e.target.value})}},{key:"handleFederatedSelectionChange",value:function(e){var t=this.getNextURLValue(),r=e.target.value;this.setState({federatedInstitution:r});var n="https://learning.oreilly.".concat(this.state.tld,"/accounts/login-academic-check/?next=").concat(t,"&idp-slug=").concat(r);this.setState({targetUrl:n})}},{key:"handleInstitutionNotListed",value:function(){this.setState({uiState:"capture"})}},{key:"returnWindowPathName",value:function(){return window.location.pathname}},{key:"get",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return fetch(e,{method:"GET",credentials:"same-origin"}).then((function(e){if(!e.ok){var r=new Error(e.statusText);throw r.response=e,r}return t?e.text():e.json()}))}},{key:"post",value:function(e,t,r){return fetch(e,{method:"POST",body:JSON.stringify(t),credentials:r,headers:{"Content-Type":"application/json"}}).then((function(e){if(!e.ok){if(422===e.status)return e.json().then((function(e){var t=new Error;throw t.response=e,t}));throw new Error(e.statusText)}return e.json()}))}},{key:"redirectToSsoLoginUrl",value:function(e){var t=e.includes("?")?"&":"?",r=encodeURIComponent(this.props.readingUrl);window.location.replace("".concat(e).concat(t,"state=").concat(r))}},{key:"fullLearningURL",value:function(e){return"www.oreilly.com"===window.location.hostname?"https://learning.oreilly.com".concat(e):"www.oreilly.review"===window.location.hostname?"https://learning.oreilly.review".concat(e):e}},{key:"fullAPIUrl",value:function(e){return"www.oreilly.com"===window.location.hostname?"https://api.oreilly.com".concat(e):"www.oreilly.review"===window.location.hostname||"www.oreilly.local"===window.location.hostname?"https://api.oreilly.review".concat(e):e}},{key:"getCredentials",value:function(){return"www.oreilly.com"===window.location.hostname||"www.oreilly.review"===window.location.hostname?"include":"same-origin"}},{key:"getNextURLValue",value:function(){var e=window.location.pathname;return e.includes("temporary-access")?"/home/":e}},{key:"determineSsoStatus",value:function(){var e=this,t=this.state,r=t.email,n=(t.ipAuth,this.fullAPIUrl("/api/v1/auth/identity-provider-lookup/")),a={email:r},i=this.getCredentials();this.setState({uiState:"loading"}),this.post(n,a,i).then((function(t){var r,n=null==t?void 0:t.identity_providers;if(Array.isArray(n)&&n.length>0){if(n.length>1)return e.setState({uiState:"showIdProviderSelector",idProviders:n}),!0;var a;r=null===(a=n[0])||void 0===a?void 0:a.sso_link_base_url}r?e.redirectToSsoLoginUrl(r):e.registerUser()})).catch((function(t){e.registerUser()}))}},{key:"registerUser",value:function(){var e=this,t=this.state,r=t.accountIdentifier,n=t.email,a=t.ipAuth,i=t.signature,o={email:n,timestamp:t.timestamp,signature:i};r&&(o.account_identifier=r),this.props.forceShow&&(o.ar=!0),this.setState({uiState:"loading"}),this.post(this.fullLearningURL("/api/v1/registration/academic/"),o,this.getCredentials()).then((function(){e.setState({uiState:"success"})})).catch((function(t){if(t.response){var r=t.response.email||t.response.non_field_errors||"";e.setState({error:r,uiState:a?"failure":"capture"})}else e.setState({error:"",uiState:"failure"})}))}},{key:"registerTemporaryUser",value:function(){var e=this.state,t=e.email,r=e.accountIdentifier;if(!t&&r){var n=new Uint8Array(32);crypto.getRandomValues(n),this.state.email="".concat(function(e){for(var t=new Uint8Array(2*e.length),r="a".charCodeAt(0)-10,n="0".charCodeAt(0),a=0,i=0;i<e.length;i++){var o=e[i]>>>4;t[a++]=o>9?o+r:o+n,o=15&e[i],t[a++]=o>9?o+r:o+n}return String.fromCharCode.apply(null,t)}(n),"@").concat(r,".com")}this.registerUser()}},{key:"renderEmailEntry",value:function(){var e=this.state,t=e.universityLogo,r=e.email,n=e.uiState,i=e.error;return e.csrfToken,a().createElement(c,{universityLogo:t},a().createElement("div",{className:"attention"},a().createElement("p",null,"Welcome! Get instant access through ",a().createElement("span",{className:"nowrap"},"your library."))),a().createElement("div",{className:"messaging"},a().createElement("p",{className:"label"},"Your academic email:"),a().createElement("div",{className:"input-container".concat(i?" error":"")},a().createElement("input",{type:"text",name:"email",placeholder:"username@institutionname.edu",value:r,onChange:this.handleInputChange,ref:function(e){return e&&e.focus()}})),i?a().createElement("small",{className:"error"},i):"",a().createElement("p",{className:"institutionLink"},a().createElement("a",{href:this.props.signInUrl},"Already a user?")),this.renderPrivacyPolicy()),a().createElement("div",{className:"buttonBox"},"loading"===n?a().createElement("img",{className:"spinner",src:"/library/view/static/images/loading.gif",alt:""}):a().createElement("button",{className:"cta",onClick:this.determineSsoStatus},"Let's Go")))}},{key:"renderTempVerified",value:function(){var e=this.state,t=e.uiState,r=e.universityLogo;return a().createElement(c,{className:"ipVerified",universityLogo:r},a().createElement("div",{className:"attention"},a().createElement("p",null,"Welcome!")),a().createElement("div",{className:"headline centered"},a().createElement("p",null,"Remote access successful. You’ve been granted access to O’Reilly Learning.")),a().createElement("div",{className:"messaging centered"},a().createElement("p",null,"Please note that because you’re using a library-based subscription, any personalized features used during this session will not be saved.")),a().createElement("div",{className:"buttonBox"},"loading"===t?a().createElement("img",{className:"spinner",src:"/library/view/static/images/loading.gif",alt:""}):a().createElement("button",{className:"cta",onClick:this.registerTemporaryUser},"Let's Go")))}},{key:"renderPrivacyPolicy",value:function(){return a().createElement("p",{className:"privacyPolicy"},"We will use your personal data in accordance with our ",a().createElement("a",{href:"https://www.oreilly.com/privacy.html"},"Privacy Policy"),".")}},{key:"renderFederated",value:function(){this.props.env;var e=this.state,t=e.federatedInstitution,r=e.universityLogo,n=e.targetUrl,i=e.mlfaIDPProviders;return a().createElement(c,{universityLogo:r},a().createElement("div",{className:"attention"},a().createElement("p",null,"Welcome! Get instant access through ",a().createElement("span",{className:"nowrap"},"your library."))),a().createElement("div",{className:"messaging federatedMessage"},a().createElement("select",{className:"styled",onChange:this.handleFederatedSelectionChange,defaultValue:""},a().createElement("option",{key:"",value:"",disabled:!0,hidden:!0},"Select your institution"),Object.keys(i).map((function(e){return a().createElement("option",{key:e,"data-key":e,value:i[e].slug},i[e].name)}))),a().createElement("div",{className:t?"":"hidden"},a().createElement("p",null,"Your institution is set up for seamless Federated access:"),a().createElement("div",{id:"federatedLoginButtonInternal"},a().createElement("a",{className:"shibboleth",href:n},"Sign In with my Institution"))),a().createElement("div",{className:"institutionLink",onClick:this.handleInstitutionNotListed},"Institution not listed?"),this.renderPrivacyPolicy()))}},{key:"renderSuccessMessage",value:function(){var e=this.state.universityLogo;return a().createElement(c,{className:"successModal",universityLogo:e},a().createElement("div",{className:"attention"},a().createElement("p",null,"Welcome to the O'Reilly Learning Platform!")),a().createElement("div",{className:"messaging centered"},a().createElement("p",null,"Your institution provides you free access to our 35K+ books, 30K+ hours of video, curated learning paths, case studies, interactive tutorials, audio books, and O'Reilly conference videos!")),a().createElement("div",{className:"buttonBox"},a().createElement("a",{className:"cta",href:this.fullLearningURL(this.props.readingUrl)},"Got It")))}},{key:"renderFailureMessage",value:function(){var e=this.state,t=e.ipAuth,r=e.referrerAuth,n=e.tld,i=e.universityLogo,o="https://www.oreilly.".concat(n,"/online-learning/support/");return a().createElement(c,{universityLogo:i},a().createElement("div",{className:"attention centered error"},a().createElement("div",null,a().createElement("img",{className:"error-alert",src:"/library/view/static/images/icons/exclamation-alert.svg",alt:"Alert"})),t?"":a().createElement("p",null,"An error has occurred with the site.")),a().createElement("div",{className:"messaging centered error"},t||r?a().createElement("p",null,"Hmm… We've verified your remote access, but we're unable to activate your account. Could you give us a few and then try again? If that still doesn't work, please ",a().createElement("a",{href:o},"contact our customer service team for help"),"."):a().createElement("p",null,"Please go back and re-enter your email address.")),a().createElement("div",{className:"buttonBox"},a().createElement("button",{className:"cta",onClick:function(){return window.location.reload(!0)}},"Try Again")))}},{key:"renderSsoMessage",value:function(){var e=this.state.universityLogo;return a().createElement(c,{className:"ssoModal",universityLogo:e},a().createElement("div",{className:"attention centered"},a().createElement("p",null,"Welcome to the O'Reilly Learning Platform!")),a().createElement("div",{className:"messaging centered"},a().createElement("p",null,"You have a free Safari account, courtesy of this library. Please wait while we connect.")))}},{key:"renderIdProviderSelector",value:function(){var e=this.state,t=e.uiState,r=e.universityLogo,n=e.idProviders;return a().createElement(c,{universityLogo:r},a().createElement("div",{className:"attention"},a().createElement("p",null,"I’m with:")),a().createElement("div",{className:"messaging federatedMessage"},a().createElement("select",{className:"styled",onChange:this.handleIdProviderSelection,defaultValue:""},a().createElement("option",{key:"",value:"",disabled:!0,hidden:!0},"Select your institution"),Object.keys(n).map((function(e){return a().createElement("option",{key:e,"data-key":e,value:n[e].sso_link_base_url},n[e].display_name)})))),a().createElement("div",{className:"buttonBox"},"loading"===t?a().createElement("img",{className:"spinner",src:"/library/view/static/images/loading.gif",alt:""}):a().createElement("button",{className:"cta",onClick:this.redirectToChosenIdProvider},"Let's Go")))}},{key:"handleIdProviderSelection",value:function(e){this.setState({chosenIdProvider:e.target.value})}},{key:"redirectToChosenIdProvider",value:function(e){"other"===e.target.value?this.setState({uiState:"showIdProviderSelector"}):this.redirectToSsoLoginUrl(this.state.chosenIdProvider)}},{key:"render",value:function(){var e=this.state,t=e.ipAuth,r=e.referrerAuth,n=e.show,a=e.uiState;return n?"ezproxy-sso"==a?this.renderSsoMessage():"success"===a?this.renderSuccessMessage():"failure"===a?this.renderFailureMessage():"sso"===a?this.renderSsoMessage():"federated"===a?this.renderFederated(!1):"ipVerified"===a||t||"referrerVerified"===a||r?this.renderTempVerified():"showIdProviderSelector"===a?this.renderIdProviderSelector():this.renderEmailEntry():null}}],r&&d(t.prototype,r),n&&d(t,n),Object.defineProperty(t,"prototype",{writable:!1}),o}(n.Component);g.propTypes={readingUrl:s().string.isRequired,signInUrl:s().string.isRequired,forceShow:s().bool.isRequired,ssoMsgTimeoutMs:s().number.isRequired};const y=g;var w=new URLSearchParams(window.location.search),b=document.getElementsByTagName("html")[0],E={accountIdentifier:b.getAttribute("data-account-identifier"),env:b.getAttribute("data-env"),federatedAuthEnabled:b.getAttribute("data-federated-auth-enabled"),forceShow:window.location.href.search(/\?ar/)>=0||parseInt(b.getAttribute("data-force-show"),10)>0||b.getAttribute("data-account-identifier"),readingUrl:w.get("next")||b.getAttribute("data-reading-url")||b.getAttribute("data-url"),signInUrl:"/member/login/?next=".concat(w.get("next")||b.getAttribute("data-url")),ssoMsgTimeoutMs:4e3},S=document.createElement("div");S.id="academic-modal",document.getElementsByTagName("body")[0].appendChild(S),(0,i.render)(a().createElement(y,E),S)}},r={};function n(e){var a=r[e];if(void 0!==a)return a.exports;var i=r[e]={id:e,loaded:!1,exports:{}};return t[e].call(i.exports,i,i.exports,n),i.loaded=!0,i.exports}n.m=t,e=[],n.O=(t,r,a,i)=>{if(!r){var o=1/0;for(u=0;u<e.length;u++){for(var[r,a,i]=e[u],s=!0,l=0;l<r.length;l++)(!1&i||o>=i)&&Object.keys(n.O).every((e=>n.O[e](r[l])))?r.splice(l--,1):(s=!1,i<o&&(o=i));if(s){e.splice(u--,1);var c=a();void 0!==c&&(t=c)}}return t}i=i||0;for(var u=e.length;u>0&&e[u-1][2]>i;u--)e[u]=e[u-1];e[u]=[r,a,i]},n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),(()=>{var e={67:0};n.O.j=t=>0===e[t];var t=(t,r)=>{var a,i,[o,s,l]=r,c=0;if(o.some((t=>0!==e[t]))){for(a in s)n.o(s,a)&&(n.m[a]=s[a]);if(l)var u=l(n)}for(t&&t(r);c<o.length;c++)i=o[c],n.o(e,i)&&e[i]&&e[i][0](),e[i]=0;return n.O(u)},r=self.webpackChunkanybird=self.webpackChunkanybird||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})(),n.O(void 0,[736],(()=>n(28594)));var a=n.O(void 0,[736],(()=>n(46729)));a=n.O(a)})();;